<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μ•”νΈν•™ & ν¨μ¤μ›λ“ λ³΄μ• μ‹¤μµ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #f0f2f5; color: #1c1e21; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1, h2 { color: #333; text-align: center; }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        h2 { font-size: 1.5em; margin-top: 0; color: #606770; }
        .container { background-color: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.1); padding: 20px; margin-top: 20px; width: 100%; max-width: 600px; }
        .card { border: 1px solid #dddfe2; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .card h3 { margin-top: 0; color: #1877f2; border-bottom: 1px solid #dddfe2; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; }
        input[type="file"], input[type="password"], input[type="text"] { width: calc(100% - 20px); padding: 10px; border: 1px solid #dddfe2; border-radius: 6px; font-size: 1em; }
        .button { background-color: #1877f2; color: white; border: none; border-radius: 6px; padding: 12px 20px; font-size: 1.1em; font-weight: 600; cursor: pointer; width: 100%; transition: background-color 0.3s; }
        .button:hover { background-color: #166fe5; }
        .button:disabled { background-color: #9dbdf2; cursor: not-allowed; }
        .spinner { display: inline-block; width: 16px; height: 16px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .flash-messages { list-style: none; padding: 0; margin-bottom: 20px; }
        .flash-messages li { padding: 15px; border-radius: 6px; margin-bottom: 10px; font-weight: 500; }
        .flash-messages .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash-messages .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .flash-messages .crack-result { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; font-family: 'Courier New', Courier, monospace; }
        .flash-messages .crack-result pre { white-space: pre-wrap; word-wrap: break-word; }
        .description { font-size: 0.9em; color: #606770; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>π›΅οΈ μ•”νΈν•™ & ν¨μ¤μ›λ“ λ³΄μ• μ‹¤μµ</h1>
    <h2>CLI ν”„λ΅μ νΈμ μ›Ή λ²„μ „ (Dockerized)</h2>

    <div class="container">
        <!-- Flash λ©”μ‹μ§€ λ° μ§μ ‘ μ „λ‹¬λ κ²°κ³Ό ν‘μ‹ μμ—­ -->
        {% set crack_result = crack_result or get_flashed_messages(category_filter=['crack_result']) | first %}
        {% if crack_result %}
            <div class="flash-messages">
                <li class="crack-result"><h3>ν…μ¤νΈ κ²°κ³Ό</h3><pre>{{ crack_result }}</pre></li>
            </div>
        {% endif %}

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash-messages">
                {% for category, message in messages %}
                    {% if category != 'crack_result' %}
                        {% if 'β…' in message %}
                             <li class="success">{{ message }}</li>
                        {% else %}
                            <li class="error">{{ message }}</li>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <!-- Part 1: μ•μ „ν• νμΌ μ•”νΈν™”/λ³µνΈν™” -->
        <div class="card">
            <h3>Part 1: (λ°©μ–΄) μ•μ „ν• νμΌ κΈκ³ </h3>
            <p class="description">AES-GCM μ•”νΈν™”μ™€ PBKDF2 ν‚¤ μ λ„ ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ νμΌμ„ μ•μ „ν•κ² μ κ·Έκ±°λ‚ μ—½λ‹λ‹¤. λ¨λ“  νμΌμ€ κ³ μ ν• μ†”νΈ(Salt)λ΅ λ³΄νΈλ©λ‹λ‹¤.</p>
            
            <!-- μ•”νΈν™” νΌ -->
            <form action="/encrypt" method="post" enctype="multipart/form-data">
                <h4>μ•”νΈν™”</h4>
                <div class="form-group">
                    <label for="enc-file">νμΌ μ„ νƒ</label>
                    <input type="file" id="enc-file" name="file" required>
                </div>
                <div class="form-group">
                    <label for="enc-password">λΉ„λ°€λ²νΈ</label>
                    <input type="password" id="enc-password" name="password" required>
                </div>
                <button type="submit" class="button">νμΌ μ•”νΈν™”</button>
            </form>
            <hr style="margin: 20px 0; border: 1px solid #f0f2f5;">
            <!-- λ³µνΈν™” νΌ -->
            <form action="/decrypt" method="post" enctype="multipart/form-data">
                <h4>λ³µνΈν™”</h4>
                <div class="form-group">
                    <label for="dec-file">μ•”νΈν™”λ νμΌ μ„ νƒ (e.g., myfile_encrypted.txt)</label>
                    <input type="file" id="dec-file" name="file" required>
                </div>
                <div class="form-group">
                    <label for="dec-password">λΉ„λ°€λ²νΈ</label>
                    <input type="password" id="dec-password" name="password" required>
                </div>
                <button type="submit" class="button">νμΌ λ³µνΈν™”</button>
            </form>
        </div>

        <!-- Part 2: λ³΄μ• ν…μ¤νΈ -->
        <div class="card">
            <h3>Part 2: (μ¦λ…) λ³΄μ• ν…μ¤νΈ</h3>
            <p class="description">Part 1μ μ•μ „ν• λ°©μ‹μΌλ΅ μ•”νΈν™”λ νμΌμ„ λ€μƒμΌλ΅ μ‚¬μ „ κ³µκ²©(Dictionary Attack)μ„ μ‹λ„ν•μ—¬, μ™ 'μ†”νΈ(Salt)'κ°€ μ¤‘μ”ν•μ§€ μ§μ ‘ μ¦λ…ν•©λ‹λ‹¤.</p>
            <form action="/test_security" method="post">
                <button type="submit" class="button" style="background-color: #2ecc71;">μ•μ „ν• μ•”νΈν™” ν¬λ™ μ‹λ„</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- κΈ°λ¥ 1: νΌ μ μ¶ μ‹ λ²„νΌ λΉ„ν™μ„±ν™” λ° μ¤ν”Όλ„ ν‘μ‹ ---
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const button = this.querySelector('button[type="submit"]');
                    if (button) {
                        button.disabled = true;
                        button.innerHTML = '<span class="spinner"></span>μ²λ¦¬ μ¤‘...';
                    }
                });
            });

            // --- κΈ°λ¥ 2: νμ΄μ§€ λ΅λ“ μ‹ μλ™ λ‹¤μ΄λ΅λ“ μ²λ¦¬ ---
            const urlParams = new URLSearchParams(window.location.search);
            const fileToDownload = urlParams.get('download_file');

            if (fileToDownload) {
                const downloadUrl = `/download/${encodeURIComponent(fileToDownload)}`;
                const link = document.createElement('a');
                link.href = downloadUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
    </script>
</body>
</html>